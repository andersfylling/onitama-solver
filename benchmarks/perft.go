package main

import (
	"fmt"
	"github.com/andersfylling/onitamago"
	"github.com/andersfylling/onitamago/benchmarks/perft"
	"time"
)

type perftInfo struct {
	duration time.Duration
	depth    int
	cards    []onitamago.Card
}

func avg(ds []time.Duration) time.Duration {
	var a int64
	for i := range ds {
		a += ds[i].Nanoseconds()
	}

	return time.Duration(a / int64(len(ds)))
}

func PERFT(results chan<- *perftInfo, cards []onitamago.Card, maxDepth int) {
	for depth := 1; depth < maxDepth; depth++ {
		var ds []time.Duration
		for i := 0; i < 4; i++ {
			_, _, _, d := perft.Perft(cards, depth)
			ds = append(ds, d)
		}

		results <- &perftInfo{
			duration: avg(ds),
			depth:    depth,
			cards:    cards,
		}
	}
}

func main() {
	cardsSlice := [...][]onitamago.Card{
		{4627019807588352, 9191917208207360, 18067449945522176, 4609221463113728, 18137612531269632},
		{18190389089402880, 9191917208207360, 4609221463113728, 9112889809960960, 22553526106324992},
		{9060113251827712, 4609221463113728, 4547854970388480, 38316124802121728, 18067449945522176},
		{22641143439163392, 4547854970388480, 9112889809960960, 2305878331024736256, 18137612531269632},
		{38316124802121728, 9060113251827712, 9130344557051904, 18067449945522176, 4627019807588352},
		{4627019807588352, 18137612531269632, 22553319947894784, 9130344557051904, 4547854970388480},
		{38316124802121728, 9060113251827712, 9042727224213504, 22553526106324992, 9130344557051904},
		{9060113251827712, 18190389089402880, 22553319947894784, 22641143439163392, 4609221463113728},
		{22553526106324992, 22641143439163392, 9112889809960960, 4627019807588352, 18137612531269632},
		{9042727224213504, 9191917208207360, 4547854970388480, 18067449945522176, 22553319947894784},
		{38316124802121728, 9060113251827712, 4547854970388480, 22641143439163392, 22553319947894784},
		{22553526106324992, 18067449945522176, 38316124802121728, 9191917208207360, 4609221463113728},
		{22553526106324992, 22641143439163392, 18190389089402880, 9112889809960960, 18137612531269632},
		{4609221463113728, 2305878331024736256, 4627019807588352, 9191917208207360, 18137612531269632},
		{9112889809960960, 9130344557051904, 22553319947894784, 4547854970388480, 18067449945522176},
		{4627019807588352, 9060113251827712, 4609221463113728, 18067449945522176, 22641143439163392},
		{9130344557051904, 18137612531269632, 9060113251827712, 22553319947894784, 18067449945522176},
		{9191917208207360, 4547854970388480, 38316124802121728, 9060113251827712, 2305878331024736256},
		{4627019807588352, 9191917208207360, 9130344557051904, 18190389089402880, 22553526106324992},
		{9060113251827712, 9191917208207360, 18137612531269632, 4609221463113728, 2305878331024736256},
	}

	for _, cards := range cardsSlice {
		fmt.Println("---------------------------------")
		for _, card := range cards {
			fmt.Print(onitamago.CardName(card) + ",")
		}
		fmt.Println("")

		for depth := 1; depth < 11; depth++ {
			_, _, _, d := perft.Perft(cards, depth)
			fmt.Println("perft", depth, d)
		}
	}
}

func printStatus(result *perftInfo) {
	fmt.Println("---------------------------------")
	for _, card := range result.cards {
		fmt.Print(onitamago.CardName(card) + ",")
	}
	fmt.Println("")
	fmt.Println("perft", result.depth, result.depth)
}
